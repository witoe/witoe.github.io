<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <title>IGUU</title><meta name="description" content="MY personal blog.">
    <link rel="preload" href="/assets/js/runtime~app.e9b55bcc.js" as="script"><link rel="preload" href="/assets/css/styles.7264dd61.css" as="style"><link rel="preload" href="/assets/js/1812.2c59b7ed.js" as="script"><link rel="preload" href="/assets/js/app.cdc4364a.js" as="script">
    <link rel="stylesheet" href="/assets/css/styles.7264dd61.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container no-sidebar"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name can-hide">IGUU</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Teaching"><span class="title">Teaching</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Teaching"><span class="title">Teaching</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/teaching/web211/" class="nav-link" aria-label="web211"><!--[--><!--]--> web211 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://orcid.org/0000-0003-1706-525X" rel="noopener noreferrer" target="_blank" aria-label="ORCID"><!--[--><!--]--> ORCID <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/iguyong/iguyong.github.io" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Teaching"><span class="title">Teaching</span><span class="arrow down"></span></button><button class="mobile-dropdown-title" type="button" aria-label="Teaching"><span class="title">Teaching</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="nav-dropdown"><!--[--><li class="dropdown-item"><a href="/teaching/web211/" class="nav-link" aria-label="web211"><!--[--><!--]--> web211 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-links-item"><a class="nav-link external" href="https://orcid.org/0000-0003-1706-525X" rel="noopener noreferrer" target="_blank" aria-label="ORCID"><!--[--><!--]--> ORCID <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/iguyong/iguyong.github.io" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><p>One of the best qualities of Python is its consistency.</p><p><em>dunder method</em>: <code>__getitem__</code>, <code>__len__</code></p><p>Unless your are doing a lot of metaprogramming, you should be implementing special methods more often than invoking them directly. The only special method that is frequently called by user code directly is <code>__init__</code>, to invoke the initializer of the superclass in your own <code>__init__</code> implementation.</p><h3 id="built-in-sequences" tabindex="-1"><a class="header-anchor" href="#built-in-sequences" aria-hidden="true">#</a> Built-in Sequences</h3><ul><li>container sequences: <code>list</code>, <code>tuple</code> and <code>collections.deque</code> can hold items of different types</li><li>flat sequences: <code>str</code>, <code>bytes</code>, <code>bytearray</code>, <code>memoryview</code> and <code>array.array</code> hold items of one type</li></ul><p>Flat sequences don&#39;t contain references but physically hold their data in contiguous memory.</p><p>Another way of grouping is by mutability</p><ul><li>mutable: <code>list</code>, <code>bytearray</code>, <code>array.array</code>, <code>collections.deque</code>, and <code>memoryview</code></li><li>immutable: <code>tuple</code>, <code>str</code>, and <code>bytes</code></li></ul><p>List comprehensions (listcomps), generator expressions, and their siblings <code>set</code> and <code>dict</code> comprehensions now have their own local scope, like functions.</p><p>Listcomps build lists from sequences or any other iterable type by filtering and transforming items. Listcomps do everything the <code>map</code> and <code>filter</code> function do, without the functionally challenged Python <strong>lambda</strong>.</p><p>To initialize tuples, arrays and other types of sequences, you could also start from a listcomp, but a genexp saves memory.</p><p>Tuple unpacking works with any iterable object. The only requirement is that the iterable yields exactly one item per variable in the receiving tuple, unless you use a star(*) to capture excess items.</p><p><code>tuple</code> supports all <code>list</code> methods that do not involve adding or removing items, with one exception --- tuples lack the <code>__reversed__</code> method. However, that is just for optimization; <code>reversed(my_typle)</code> works without it.</p><p>If <code>__add__</code> is not implemented, Python falls back to call <code>__add__</code>. Consider <code>a += b</code>. If <code>a</code> implements <code>__iadd__</code>, that will be called. In the case of mutable sequences, <code>a</code> will be changed in place. However, when <code>a</code> does not implement <code>__iadd__</code>, the expression <code>a += b</code> has the same effect as <code>a = a + b</code>: the expression <code>a + b</code> is evaluated first, producing a new object, which is then bound to <code>a</code>. In other words, the identify of the object bound to <code>a</code> may or may not change, depending on the availability of <code>__iadd__</code>.</p><p>Repeated concatenation of immutable sequences is inefficient, but <code>str</code> is an exception because CPython is optimized for it by allocating spare room in memory.</p><p>An intriguing corner case:</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&gt;&gt;&gt; t = (1,2,[30,40])
&gt;&gt;&gt; t[2] += [50, 60]
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
TypeError: &#39;tuple&#39; object does not support item assignment
&gt;&gt;&gt; t
(1, 2, [30, 40, 50, 60])
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&gt;&gt;&gt; dis.dis(&#39;s[a] += b&#39;)
  1           0 LOAD_NAME                0 (s)
              2 LOAD_NAME                1 (a)
              4 DUP_TOP_TWO
              6 BINARY_SUBSCR
              8 LOAD_NAME                2 (b)
             10 INPLACE_ADD
             12 ROT_THREE
             14 STORE_SUBSCR
             16 LOAD_CONST               0 (None)
             18 RETURN_VALUE
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>Putting mutable items in tuples is not a good idea.</li><li>Augmented assignment is not an atomic operation</li><li>Inspecting Python bytecode is not too difficult, and is often helpful to see what is going on under the hood.</li></ul><p>Functions or methods that change an object in place should return <code>None</code> to make it clear to the caller that the object itself was changed and no new object was created.</p><p>In contrast, the built-in function <code>sorted</code> creates a new list and return it. In fact, it accepts any iterable object as an argument, including immutable sequences and generators. Regardless of the type of iterable given to <code>sorted</code>, it always returns a newly created list.</p><p>Timsort --- the sorting algorithm used in <code>sorted</code> and <code>list.sort</code> --- is stable. It is an adaptive algorithm that switchs from insertion sort to merge sort strategies.</p><p><code>bisect.bisect</code>, <code>bisect.bisect_left</code>, <code>bisect.insort</code>, <code>bisect.insort_left</code></p><p>If you need to store 10 million floating-point values, an <code>array</code> is much more efficient than a <code>list</code>.</p><p>Beside <code>collections.deque</code>, other Python standard library packages implement queues:</p><ul><li><code>queue</code>: <code>Queue</code>, <code>LifoQueue</code>, <code>PriorityQueue</code></li><li><code>multiprocessing</code>: <code>Queue</code>, <code>JoinableQueue</code></li><li><code>asyncio</code>: <code>Queue</code>, <code>LifoQueue</code>, <code>PriorityQueue</code>, <code>JoinableQueue</code></li><li><code>heapq</code></li></ul><p><code>dict</code>, <code>defaultdict</code>, <code>OrderedDict</code>, <code>ChainMap</code>, <code>Counter</code><br> Two powerful methods: <code>setdefault</code>, <code>update</code><br><code>Mapping</code>, <code>MutableMapping</code>, <code>MappingProxyType</code></p><p>Each item in <code>bytes</code> or <code>bytearray</code> is an integer from 0 to 255, and not a one-character string. However, a slice of a binary sequence always produce a binary sequence of the same type --- including slices of length 1.</p><p>The only sequence type where <code>s[0] == s[:1]</code> is the <code>str</code> type.</p><p>Three different displays are used, depending on each byte value. Both <code>bytes</code> and <code>bytearray</code> support every <code>str</code> method except those that do formating and a few others that depend on Unicode data.</p><p><code>memoryview</code>, <code>struct</code>, <code>mmap</code></p><p>character encoding detecting: <code>Chardet</code>, <code>chardetect</code></p><p>endianness: BOM</p><p>In Python 3, <code>map</code> and <code>filter</code> return generators --- a form of iterator --- so their direct substitute is now a generator expression.</p><p>A class implementing <code>__call__</code> is an easy way to creat funciton-like objects that have some internal state that must be kept acrosss invocations. A totally different approach to creating functions with internal state is to use closures.</p><p>Retriving information about parameters: <code>inspect</code> module</p><p>The <code>operator</code> module: <code>itemgetter</code>, <code>attrgetter</code>, <code>methodcaller</code><br> The <code>functools</code> module: <code>partial</code>, <code>partialmethod</code></p><p>Decorators: <code>property</code>, <code>classmethod</code>, <code>staticmethod</code>, <code>functools.wraps</code>, <code>functools.lru_cache</code>, <code>functools.singledispatch</code></p><p>lexical scope vs. dynamic scope</p><blockquote><p>To understand an assignment in Python, always read the right-hand side first: that&#39;s where the object is created or retrived. After that, the variable on the left is bound to the object, like a label stuck to it. Just forget about boxes.</p></blockquote><p>Every object has an identity, a type and a value. An object&#39;s identity never changes once it has been created (only the value of an object changes over time); you may think of it as the object&#39;s adress in memory. The <code>is</code> operator compares the identity of two objects; the <code>id()</code> fucntion returns an integer representing its identity.</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a <span class="token operator">=</span> <span class="token boolean">None</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> b <span class="token operator">=</span> <span class="token boolean">None</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a <span class="token operator">==</span> b
<span class="token boolean">True</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a <span class="token keyword">is</span> b <span class="token comment"># faster than ==</span>
<span class="token boolean">True</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>The easiest way to copy a list (or most built-in mutable collections) is to use the built-in constructor for the type itself. However, using the constructor or <code>[:]</code> produces a <em>shallow copy</em>.</p><p><code>copy.copy()</code>, <code>copy.deepcopy()</code><br> Note that making deep copy is not a simple matter in the general case. Objects have cyclic references that would cause a naive algorithm to enter an infinite loop. The <code>deepcopy</code> function remembers the objects already copied to handle cyclic references gracefully.</p><p>Mutable types as parameter defaults: bad idea</p><p>default argument is evaluated only once at the point of function definition in the defining scope.</p><p>The issue with mutable defaults explains why <code>None</code> is often used as the default value for parameters that may receive mutable values.</p><p>The <code>del</code> statement deletes names, not objects.</p><p><code>weakref</code></p><p>Consider using <code>WeakKeyDictionary</code>, <code>WeakValueDictionary</code>, <code>WeakSet</code> and <code>finalize</code>(which use weak references internally) instead of creating and handling your own <code>weakref.ref</code> instances by hand.</p><p>If you need to build a class that is aware of every one of its instances, a good solution is to create a class attribute with a <code>WeakSet</code> to hold the references to the instances.</p><p>Not every Python object may be the target, or referent, of a weak reference. Basid <code>list</code> and <code>dict</code> instances may not be referents, but a plain subclass of either can solve this problem easily. Most of these limitations are implementation details of CPython that may not apply to other Python interpreters.</p><p>CPython may cheat when copying:</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> t1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> t2 <span class="token operator">=</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> t2 <span class="token keyword">is</span> t1
<span class="token boolean">True</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> t3 <span class="token operator">=</span> t1<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> t3 <span class="token keyword">is</span> t1
<span class="token boolean">True</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>string interning</p><p>Instances of user-defined classes are mutable by default in Python -- as in most object-oriented languages. When creating your own objects, you have to be extra careful to make them immutable, if that is a requirement.</p><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="nav-link external meta-item-label" href="https://github.com/iguyong/iguyong.github.io/edit/main/docs/python/notes_for_fluent_python.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">11/24/2021, 8:54:40 AM</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: jcel@qq.com">guyong</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/assets/js/runtime~app.e9b55bcc.js" defer></script><script src="/assets/js/1812.2c59b7ed.js" defer></script><script src="/assets/js/app.cdc4364a.js" defer></script>
  </body>
</html>
